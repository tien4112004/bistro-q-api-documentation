\doxysection{Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service Class Reference}
\hypertarget{classBistroQ_1_1Services_1_1Services_1_1OrderItemService}{}\label{classBistroQ_1_1Services_1_1Services_1_1OrderItemService}\index{BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}}


Inheritance diagram for Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=215pt]{classBistroQ_1_1Services_1_1Services_1_1OrderItemService__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=215pt]{classBistroQ_1_1Services_1_1Services_1_1OrderItemService__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a6830a141c756520db34dc23877a7604f}{Order\+Item\+Service}} (\mbox{\hyperlink{interfaceBistroQ_1_1Core_1_1Interfaces_1_1IUnitOfWork}{IUnit\+Of\+Work}} unit\+Of\+Work, IMapper mapper)
\item 
async Task$<$(IEnumerable$<$ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1DetailOrderItemDto}{Detail\+Order\+Item\+Dto}} $>$ Items, int Count)$>$ \mbox{\hyperlink{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_ae1c31700a0a99da4e7f38b576446da14}{Get\+Order\+Items\+Async}} (\mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1OrderItemCollectionQueryParams}{Order\+Item\+Collection\+Query\+Params}} query\+Params)
\begin{DoxyCompactList}\small\item\em Retrieves a paginated list of order items based on the specified query parameters. \end{DoxyCompactList}\item 
async Task$<$ IEnumerable$<$ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1OrderItemDto}{Order\+Item\+Dto}} $>$ $>$ \mbox{\hyperlink{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a076ab60c53374068899242f7522771f3}{Update\+Order\+Items\+Status\+Async}} (IEnumerable$<$ string $>$ order\+Items, Order\+Item\+Status status)
\begin{DoxyCompactList}\small\item\em Updates the status of multiple order items simultaneously. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{interfaceBistroQ_1_1Core_1_1Interfaces_1_1Services_1_1IOrderItemService}{Bistro\+Q.\+Core.\+Interfaces.\+Services.\+IOrder\+Item\+Service}}}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{OrderItemService_8cs_source_l00013}{13}} of file \mbox{\hyperlink{OrderItemService_8cs_source}{Order\+Item\+Service.\+cs}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a6830a141c756520db34dc23877a7604f}\index{BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}!OrderItemService@{OrderItemService}}
\index{OrderItemService@{OrderItemService}!BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}}
\doxysubsubsection{\texorpdfstring{OrderItemService()}{OrderItemService()}}
{\footnotesize\ttfamily \label{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a6830a141c756520db34dc23877a7604f} 
Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service.\+Order\+Item\+Service (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{interfaceBistroQ_1_1Core_1_1Interfaces_1_1IUnitOfWork}{IUnit\+Of\+Work}}}]{unit\+Of\+Work}{, }\item[{IMapper}]{mapper}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{OrderItemService_8cs_source_l00018}{18}} of file \mbox{\hyperlink{OrderItemService_8cs_source}{Order\+Item\+Service.\+cs}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00019\ \ \ \ \ \{}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \_unitOfWork\ =\ unitOfWork;}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \_mapper\ =\ mapper;}
\DoxyCodeLine{00022\ \ \ \ \ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_ae1c31700a0a99da4e7f38b576446da14}\index{BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}!GetOrderItemsAsync@{GetOrderItemsAsync}}
\index{GetOrderItemsAsync@{GetOrderItemsAsync}!BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}}
\doxysubsubsection{\texorpdfstring{GetOrderItemsAsync()}{GetOrderItemsAsync()}}
{\footnotesize\ttfamily \label{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_ae1c31700a0a99da4e7f38b576446da14} 
async Task$<$(IEnumerable$<$ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1DetailOrderItemDto}{Detail\+Order\+Item\+Dto}} $>$ Items, int Count)$>$ Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service.\+Get\+Order\+Items\+Async (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1OrderItemCollectionQueryParams}{Order\+Item\+Collection\+Query\+Params}}}]{query\+Params}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Retrieves a paginated list of order items based on the specified query parameters. 


\begin{DoxyParams}{Parameters}
{\em query\+Params} & Parameters for filtering, sorting, and pagination of order items.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A tuple containing\+:
\begin{DoxyItemize}
\item Items\+: Collection of order items matching the query parameters
\item Count\+: Total number of items matching the query (before pagination) 
\end{DoxyItemize}
\end{DoxyReturn}


The returned count represents the total number of items that match the filter criteria, not just the number of items in the current page. 

Implements \mbox{\hyperlink{interfaceBistroQ_1_1Core_1_1Interfaces_1_1Services_1_1IOrderItemService_a36e8130eefe4e73ccf384cea7774b747}{Bistro\+Q.\+Core.\+Interfaces.\+Services.\+IOrder\+Item\+Service}}.



Definition at line \mbox{\hyperlink{OrderItemService_8cs_source_l00024}{24}} of file \mbox{\hyperlink{OrderItemService_8cs_source}{Order\+Item\+Service.\+cs}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00025\ \ \ \ \ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ var\ builder\ =}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Common_1_1Builder_1_1OrderItemQueryableBuilder}{OrderItemQueryableBuilder}}(\_unitOfWork.OrderItemRepository.GetQueryable())}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .WithStatus(queryParams.Status)}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .WithCreatedDateRange(queryParams.CreatedFrom,\ queryParams.CreatedTo)}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .WithUpdatedDateRange(queryParams.UpdatedFrom,\ queryParams.UpdatedTo);}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ var\ count\ =\ await\ \_unitOfWork.OrderItemRepository.GetOrderItemsCountAsync(builder.Build());}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ builder}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ .IncludeAll()}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ .ApplySorting(queryParams.OrderBy,\ queryParams.OrderDirection)}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ .ApplyPaging(queryParams.Page,\ queryParams.Size);}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ var\ orderItems\ =\ await\ \_unitOfWork.OrderItemRepository.GetOrderItemsAsync(builder.Build());}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\_mapper.Map<IEnumerable<DetailOrderItemDto>>(orderItems),\ count);}
\DoxyCodeLine{00042\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a076ab60c53374068899242f7522771f3}\index{BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}!UpdateOrderItemsStatusAsync@{UpdateOrderItemsStatusAsync}}
\index{UpdateOrderItemsStatusAsync@{UpdateOrderItemsStatusAsync}!BistroQ.Services.Services.OrderItemService@{BistroQ.Services.Services.OrderItemService}}
\doxysubsubsection{\texorpdfstring{UpdateOrderItemsStatusAsync()}{UpdateOrderItemsStatusAsync()}}
{\footnotesize\ttfamily \label{classBistroQ_1_1Services_1_1Services_1_1OrderItemService_a076ab60c53374068899242f7522771f3} 
async Task$<$ IEnumerable$<$ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Dtos_1_1Orders_1_1OrderItemDto}{Order\+Item\+Dto}} $>$ $>$ Bistro\+Q.\+Services.\+Services.\+Order\+Item\+Service.\+Update\+Order\+Items\+Status\+Async (\begin{DoxyParamCaption}\item[{IEnumerable$<$ string $>$}]{order\+Item\+Ids}{, }\item[{Order\+Item\+Status}]{status}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Updates the status of multiple order items simultaneously. 


\begin{DoxyParams}{Parameters}
{\em order\+Item\+Ids} & Collection of order item IDs to update.\\
\hline
{\em status} & The new status to apply to all specified order items.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Collection of updated order items with their new status.
\end{DoxyReturn}


This operation\+:
\begin{DoxyItemize}
\item Updates all specified order items atomically
\item Validates status transitions for each item
\item Returns the updated items in their new state 
\end{DoxyItemize}


\begin{DoxyExceptions}{Exceptions}
{\em Conflict\+Exception} & Thrown when any status transition is invalid.\\
\hline
{\em Resource\+Not\+Found\+Exception} & Thrown when any of the specified order items cannot be found.\\
\hline
\end{DoxyExceptions}


Implements \mbox{\hyperlink{interfaceBistroQ_1_1Core_1_1Interfaces_1_1Services_1_1IOrderItemService_ac15815ec186f6ea9a3d2484d1eaa7b0f}{Bistro\+Q.\+Core.\+Interfaces.\+Services.\+IOrder\+Item\+Service}}.



Definition at line \mbox{\hyperlink{OrderItemService_8cs_source_l00044}{44}} of file \mbox{\hyperlink{OrderItemService_8cs_source}{Order\+Item\+Service.\+cs}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00045\ \ \ \ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ var\ enumerable\ =\ orderItems\ as\ \textcolor{keywordtype}{string}[]\ ??\ orderItems.ToArray();}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ var\ updatedOrderItems\ =\ \textcolor{keyword}{new}\ List<OrderItem>();}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ decimal\ totalCancelAmount\ =\ 0;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ await\ \_unitOfWork.BeginTransactionAsync();}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ i\ =\ 0;\ i\ <\ enumerable.Count();\ i++)}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ orderItem\ =\ await\ \_unitOfWork.OrderItemRepository.GetByIdAsync(enumerable[i]);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (orderItem\ ==\ \textcolor{keyword}{null})}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBistroQ_1_1Core_1_1Exceptions_1_1ResourceNotFoundException}{ResourceNotFoundException}}(\$\textcolor{stringliteral}{"{}Order\ item\ with\ id\ \{enumerable[i]\}\ not\ found."{}});}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classBistroQ_1_1Services_1_1Common_1_1OrderItemStatusTransition}{OrderItemStatusTransition}}.\mbox{\hyperlink{classBistroQ_1_1Services_1_1Common_1_1OrderItemStatusTransition_a27b643296f213a8b62d01e565802611e}{UpdateStatus}}(orderItem,\ status);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ totalCancelAmount\ +=\ orderItem.Quantity.Value\ *\ orderItem.PriceAtPurchase.Value;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ updatedOrderItems.Add(orderItem);}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ var\ order\ =\ await\ \_unitOfWork.OrderRepository.GetByIdAsync(updatedOrderItems.First().OrderId);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ OrderItemStatus.Cancelled)}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ order.TotalAmount\ -\/=\ totalCancelAmount;}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ await\ \_unitOfWork.OrderRepository.UpdateAsync(order,\ order);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ await\ \_unitOfWork.SaveChangesAsync();}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ await\ \_unitOfWork.CommitTransactionAsync();}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ (Exception\ e)}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ await\ \_unitOfWork.RollbackTransactionAsync();}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_mapper.Map<IEnumerable<OrderItemDto>>(updatedOrderItems);}
\DoxyCodeLine{00085\ \ \ \ \ \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
Bistro\+Q.\+Services/\+Services/Order\+Item\+Service.\+cs\end{DoxyCompactItemize}
